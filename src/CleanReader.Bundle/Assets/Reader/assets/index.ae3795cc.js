var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var j=(u,a,n)=>a in u?Z(u,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[a]=n,N=(u,a)=>{for(var n in a||(a={}))oe.call(a,n)&&j(u,n,a[n]);if($)for(var n of $(a))ne.call(a,n)&&j(u,n,a[n]);return u},A=(u,a)=>ee(u,te(a));import{d as Y,u as ie,r as G,o as F,g as D,w as T,B as re,a as O,b as P,c as se,e as le,f as U,h as ae,i as J,n as ce,j as ue,v as de}from"./vendor.7fa8887f.js";const he=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const f of t)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function n(t){const f={};return t.integrity&&(f.integrity=t.integrity),t.referrerpolicy&&(f.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?f.credentials="include":t.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(t){if(t.ep)return;t.ep=!0;const f=n(t);fetch(t.href,f)}};he();const fe={key:0,id:"reader-area"},ge=Y({props:{url:{default:""},epubFileOptions:null,epubOptions:null,startCfi:null,initHighlights:null,initLocations:null,scrollBehavior:null},emits:["bookChanged","renditionChanged","pageChanged","tocChanged","selectionChanged"],setup(u,{expose:a,emit:n}){const d=u;ie(o=>({"7a7356dc":d.scrollBehavior}));const t=G({isLoaded:!1,book:null,rendition:null,currentCfi:"",isScrolling:!1,isInSelectionMode:!1,touchEvent:{},selectedEvent:{},tempLocation:null,justResized:!1,correcting:!1});F(()=>{window.epubReader=D()});function f(o){!t.book||Promise.all(t.book.spine.spineItems.map(e=>{var r;return e.load((r=t==null?void 0:t.book)==null?void 0:r.load.bind(t==null?void 0:t.book)).then(e.find.bind(e,o)).finally(e.unload.bind(e))})).then(e=>Promise.resolve([].concat.apply([],e))).then(e=>{e.length>0&&e.map(r=>{var c,g;let l=(c=t.book)==null?void 0:c.spine.get(r.cfi),s=(g=t.book)==null?void 0:g.navigation.get((l==null?void 0:l.href)||"");r.chapter=s==null?void 0:s.label.trim()}),E("Search",e)})}function m(o){o.code==="ArrowLeft"?b("PREV"):o.code==="ArrowRight"&&b("NEXT")}function b(o){!t.rendition||(o=="PREV"?t.rendition.prev():t.rendition.next())}function M(o){if(!t.book)return;const e=o&&o.start,r=o&&o.end,l=o&&o.start.slice(8).split("!")[0],s=t.book.spine.get(e),c=t.book.navigation.get(s.href),g=c&&c.label.trim(),S=c&&c.id,k=s.href,R=t.book.locations,K=R.locationFromCfi(e),Q=R.total;E("Progress",{chapterId:S,chapterHref:k,chapterName:g,currentPage:K,totalPage:Q,startCfi:e,endCfi:r,base:l}),t.currentCfi=e,y()}function B(o,e){!t.rendition||(t.rendition.annotations.remove(o,"highlight"),t.rendition.annotations.highlight(o,{},()=>{},"epub-highlight",{fill:e||"#fdf183"}),y())}function V(o){!t.rendition||t.rendition.annotations.remove(o,"highlight")}T(()=>t.rendition,(o,e)=>{e&&(document.removeEventListener("keyup",m,!1),e.off("keyup",m),e.off("locationChanged",M),e.off("selected",X),e.off("relocated",i),e.off("resized",h)),!!o&&(document.addEventListener("keyup",m,!1),o.on("keyup",m),o.on("locationChanged",M),o.on("selected",X),o.on("relocated",i),o.on("resized",h),o.hooks.content.register(W),n("renditionChanged",o))}),T(()=>d.url,(o,e)=>{!o||(t.book&&t.book.destroy(),t.book=new re("",d.epubFileOptions),n("bookChanged",t.book),t.book.loaded.navigation.then(({toc:r})=>{t.isLoaded=!0,E("Toc",r)}).catch(()=>{E("Failed","Toc")}),t.book.ready.then(()=>{var r,l,s;if(!!t.book&&(E("Initialized",{}),d.initLocations?t.book.locations.load(d.initLocations):t.book.locations.generate(1e3).then(()=>{var c;E("Locations",(c=t.book)==null?void 0:c.locations.save())}),t.book.spine)){let c=d.startCfi;c||(c=(s=(l=(r=t.book.rendition)==null?void 0:r.location)==null?void 0:l.start)==null?void 0:s.cfi);const g=t.book.renderTo("reader-area",N({width:"100%",height:"100%"},d.epubOptions));t.rendition=g,d.initHighlights&&d.initHighlights.forEach(S=>{var k;(k=t.rendition)==null||k.annotations.highlight(S.CfiRange,{},()=>{},"epub-highlight",{fill:S.Color})}),c?g.display(c):g.display()}}),t.book.open(d.url,"epub").catch(r=>E("Failed","Book")))}),T(()=>d.startCfi,(o,e)=>{var r;!o||(r=t.rendition)==null||r.display(o)});function W(o){const e=o.document.documentElement;t.bookElement=e,e&&(e.addEventListener("touchstart",z,!0),e.addEventListener("touchmove",x,!0),e.addEventListener("touchcancel",H),e.addEventListener("touchend",C),e.addEventListener("mousedown",z),e.addEventListener("mousemove",x),e.addEventListener("mouseup",C),e.addEventListener("wheel",w))}function I(o){return o.type.indexOf("mouse")!==-1?o.clientX:o.touches[0].clientX}function L(o){return o.type.indexOf("mouse")!==-1?o.clientY:o.touches[0].clientY}function z(o){let e=t.touchEvent,r=o.type.indexOf("touch")>=0,l=o.type.indexOf("mouse")>=0;r&&(e.lastTouchStartTime=o.timeStamp),!(l&&e.lastTouchStartTime&&o.timeStamp-e.lastTouchStartTime<350)&&(e.touchStarted||(e.touchStarted=!0,e.touchMoved=!1,e.swipeOutBounded=!1,e.startX=I(o),e.startY=L(o),e.currentX=0,e.currentY=0,e.touchStartTime=o.timeStamp,e.hasSwipe=!0))}function x(o){let e=t.touchEvent,r=I(o),l=L(o);if(e.currentX=r,e.currentY=l,e.touchMoved){if(e.hasSwipe&&!e.swipeOutBounded){var c=30;e.swipeOutBounded=Math.abs(e.startX-e.currentX)>c&&Math.abs(e.startY-e.currentY)>c}}else{var s=10;e.touchMoved=Math.abs(e.startX-e.currentX)>s||Math.abs(e.startY-e.currentY)>s}}function H(){let o=t.touchEvent;o.touchStarted=o.touchMoved=!1,o.startX=o.startY=0}function C(o){let e=t.touchEvent,r=o.type.indexOf("touch")>=0,l=o.type.indexOf("mouse")>=0;if(r&&(e.lastTouchEndTime=o.timeStamp),e.touchStarted=!1,!(l&&e.lastTouchEndTime&&o.timeStamp-e.lastTouchEndTime<350))if(e.touchMoved)if(t.selectedEvent&&t.selectedEvent.Text&&!r)E("ContextMenu",t.selectedEvent);else if(r&&e.hasSwipe&&!e.swipeOutBounded){t.selectedEvent=null;var s=30,c,g=Math.abs(e.startY-e.currentY),S=Math.abs(e.startX-e.currentX);(g>s||S>s)&&(g>s?c=e.startY>e.currentY?"top":"bottom":c=e.startX>e.currentX?"left":"right",v(c))}else t.selectedEvent=null;else if(t.selectedEvent&&t.selectedEvent.Text){let k=I(o),R=L(o);k>=t.selectedEvent.X&&k<=t.selectedEvent.Right&&R>=t.selectedEvent.Y&&R<=t.selectedEvent.Bottom?E("ContextMenu",t.selectedEvent):t.selectedEvent=null}else p(o)}function X(o,e){if(!e||!o)return;let r=e.window.getSelection(),l=r==null?void 0:r.toString(),s=r==null?void 0:r.getRangeAt(0).getBoundingClientRect(),c=s==null?void 0:s.x,g=s==null?void 0:s.y,S=s==null?void 0:s.right,k=s==null?void 0:s.bottom;t.selectedEvent={Text:l,X:c,Y:g,Right:S,Bottom:k,Range:o}}function i(){!t.rendition||(t.justResized?(t.justResized=!1,t.correcting=!0,t.rendition.display(t.tempLocation)):t.correcting?t.correcting=!1:t.tempLocation=t.rendition.currentLocation().start.cfi)}function h(){t.justResized=!0}function p(o){let e=0;const r=o;r.offsetX?e=r.screenX:e=o.changedTouches[0].screenX,e=e-window.screenLeft;let l=document.documentElement.clientWidth,s=l>900?l/3:l/4;e<s?b("PREV"):e>l-s?b("NEXT"):E("Menu",e)}function v(o){o=="left"?b("NEXT"):o=="right"&&b("PREV")}function w(o){t.isScrolling||(t.isScrolling=!0,o.deltaY>0||o.deltaX<0?b("NEXT"):b("PREV"),setTimeout(()=>{t.isScrolling=!1},300))}function y(){if(!t.bookElement)return;let o=document.querySelectorAll(".epub-highlight");o.length>0&&o.forEach(e=>{e.removeEventListener("mouseup",_),e.removeEventListener("touchend",_),e.addEventListener("mouseup",_),e.addEventListener("touchend",_)})}function _(o){let l=o.srcElement.parentElement.dataset.epubcfi;l&&E("ShowHighlight",l)}function E(o,e){var l;var r=JSON.stringify({Name:o,Path:(l=d.url)!=null?l:"",Data:JSON.stringify(e)});window.chrome.webview?window.chrome.webview.postMessage(r):console.log(r)}return a({highlight:B,offHighlight:V,search:f}),(o,e)=>O(t).isLoaded?(P(),se("div",fe)):le("",!0)}}),q=u=>{const a=u.getFullYear(),n=u.getMonth()+1,d=u.getDate();return`${a}-${n}-${d}`},pe={"::selection":{"background-color":"#d4e9ff"},img:{"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}};function Ee(){const u=U(0),a=U(0);function n(){u.value=window.innerWidth,a.value=window.innerHeight}return F(()=>{window.addEventListener("resize",n),n()}),ae(()=>{window.removeEventListener("resize",n)}),{width:u,height:a}}const me=Y({setup(u,{expose:a}){const n=G({url:"",book:null,rendition:null,startCfi:"",initHighlights:[],initLocations:"",layoutStyle:{},bookStyle:{fontFamily:"Origin",fontSize:16,lineHeight:1.4,background:"transparent",foreground:"black"},bookOption:{flow:"paginated",resizeOnOrientationChange:!0,spread:"auto",minSpreadWidth:1e3,scrollBehavior:"smooth"},currentSelection:{cfiRange:"",contents:null},viewerLayout:{MIN_VIEWER_WIDTH:600,MIN_VIEWER_HEIGHT:300,VIEWER_HEADER_HEIGHT:0,VIEWER_FOOTER_HEIGHT:0,VIEWER_SIDEMENU_WIDTH:0},size:Ee()});F(()=>{window.reader=D()}),T(()=>n.size.width,()=>{H()}),T(()=>n.size.height,()=>{H()}),T(()=>n.book,()=>X);const d=i=>n.book=i,t=i=>{n.rendition=i,C()},f=(i,h)=>n.currentSelection={cfiRange:i,contents:h},m=i=>console.log(i),b=i=>console.log(i);function M(i){n.bookStyle=i,C()}function B(i,h,p){n.bookOption={flow:i?"scrolled-doc":"paginated",spread:"auto",resizeOnOrientationChange:!0,minSpreadWidth:h!=null?h:1e3,scrollBehavior:p?"smooth":"auto"},C()}function V(i,h,p,v,w,y,_){n.url=i,n.bookOption={flow:h?"scrolled-doc":"paginated",spread:"auto",resizeOnOrientationChange:!0,minSpreadWidth:y!=null?y:1e3,scrollBehavior:_?"smooth":"auto"},w&&(n.initHighlights=JSON.parse(w)),n.startCfi=p,n.initLocations=v}function W(i){!n.rendition||!i||n.rendition.display(i)}function I(i=!1){n.bookOption.flow=i?"scrolled-doc":"paginated",C()}function L(i,h){window.epubReader.exposed.highlight(i,h)}function z(i){window.epubReader.exposed.search(i)}function x(i){!n.rendition||!i||n.rendition.display(i)}function H(){if(!n.rendition)return;const i=n.viewerLayout||{MIN_VIEWER_WIDTH:600,MIN_VIEWER_HEIGHT:300,VIEWER_HEADER_HEIGHT:0,VIEWER_FOOTER_HEIGHT:0,VIEWER_SIDEMENU_WIDTH:0},{innerWidth:h,innerHeight:p}=window,v=i.VIEWER_HEADER_HEIGHT+i.VIEWER_FOOTER_HEIGHT,w=h-~~((h-i.MIN_VIEWER_WIDTH)/100*0),y=n.bookOption.flow==="scrolled-doc"?p-v:p-v-~~((p-v-i.MIN_VIEWER_HEIGHT)/100*0),_=n.bookOption.flow==="scrolled-doc"?"":`${~~((p-v-i.MIN_VIEWER_HEIGHT)/100*0)/2}px`;(n.layoutStyle.width!==w||n.layoutStyle.height!==y||n.layoutStyle.marginTop!==_)&&(n.layoutStyle=A(N({},n.layoutStyle),{width:w,height:y,marginTop:0,marginBottom:0}));try{n.rendition.resize(w,y)}catch{}}function C(){if(!n.rendition)return;H();const i={body:{padding:"0px !important","background-color":`${n.bookStyle.background} !important`,color:`${n.bookStyle.foreground}`},p:{"line-height":`${n.bookStyle.lineHeight} !important`}};n.rendition.flow(n.bookOption.flow),n.rendition.spread(n.bookOption.spread,n.bookOption.minSpreadWidth),n.bookStyle.fontFamily!=="Origin"&&Object.assign(i.body,{"font-family":`${n.bookStyle.fontFamily} !important`}),n.bookStyle.additionalStyle&&Object.assign(i,n.bookStyle.additionalStyle),n.bookOption.flow==="scrolled-doc"?Object.assign(i.body,{margin:"auto !important"}):n.bookOption.spread==="auto"?Object.assign(i.body,{}):Object.assign(i.body,{}),n.rendition.themes.register("main",pe),n.rendition.themes.register("custom",i),n.rendition.themes.select("custom"),n.rendition.themes.override("color",n.bookStyle.foreground),n.rendition.themes.fontSize(n.bookStyle.fontSize+"px"),document.body.style.background=n.bookStyle.background}function X(){!n.book||Promise.all([n.book.loaded.metadata,n.book.opened]).then(([i,h])=>{const p={coverURL:h.archive.urlCache[h.cover],title:i.title,description:i.description,published_date:q(new Date(i.pubdate)),modified_date:q(new Date(i.modified_date)),author:i.creator,publisher:i.publisher,language:i.language};console.log(`\u4E66\u7C4D\u4FE1\u606F: ${p}`)}).catch(i=>{throw`${i.stack} 

 Message : Epub parsing failed.`})}return a({setBook:V,setFlow:I,setChapter:W,setStyle:M,setOptions:B,setHighlight:L,search:z,changeLocation:x}),(i,h)=>(P(),J(ge,{url:O(n).url,style:ce(O(n).layoutStyle),startCfi:O(n).startCfi,initLocations:O(n).initLocations,initHighlights:O(n).initHighlights,scrollBehavior:O(n).bookOption.scrollBehavior,ref:"reader",onBookChanged:d,onRenditionChanged:t,onTocChanged:m,onPageChanged:b,onSelectionChanged:f},null,8,["url","style","startCfi","initLocations","initHighlights","scrollBehavior"]))}});const be=Y({setup(u){return(a,n)=>(P(),J(me))}});ue(be).use(de).mount("#app");
